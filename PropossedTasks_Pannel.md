NOTA: En la carpeta "Documentation" se han inclu√≠do varios archivos .md que contienen explicaciones t√©cnicas de c√≥mo fueron creados las diversas funcionalidades, verifica dichos archivos, al igual que los archivos de c√≥digo, en caso de alguna duda. Marca las tareas completadas o en proceso como se indica en cada secci√≥n. 

# üìñ M√≥dulos de Personalizaci√≥n (nomenclatura)

Los nombres internos de m√≥dulos usan prefijo g (p. ej., gTheme, gStyle) para evitar conflictos. En las URLs p√∫blicas y la UI se usan nombres comunes: /admin/theme (Theme), /admin/style (Style).

* **gTheme (Theme)**: Gesti√≥n de temas por tenant. Define y versiona design tokens (colores, tipograf√≠as, espaciados, sombras, radios, z-index, transiciones, opacidades, breakpoints) y configura modos light/dark. Aplica temas activos por tenant con fallback global y export/import.
* **gStyle (Style)**: Gesti√≥n de variantes de componentes (Button, Input, Select, Checkbox, Radio, Switch, Badge, Tag, Alert, Tooltip, Modal, Drawer, Tabs, Accordion, Card, Table, Pagination, Navbar, Sidebar, Footer, Hero, Section, CTA, etc.) heredando tokens de gTheme con overrides seguros.
* **gAdmin (Admin Panel)**: App Next.js (TS + Tailwind + shadcn/ui) que expone UI para gTheme, gStyle y el resto del Core. Integra auth, RBAC, i18n, previsualizaci√≥n, auditor√≠a y publicaci√≥n.
* **gAuth / gMemberships**: Autenticaci√≥n, roles y permisos (OWNER/ADMIN/EDITOR/REVIEWER/VIEWER). Controla qui√©n puede crear/editar/aplicar temas y estilos.
* **gPages (Pages)**: Generador de p√°ginas y bloques reutilizables que consumen tokens/variantes para validar estilos y construir contenido visual consistente.
* **plugin-sdk**: Tipos y cliente OpenAPI/TS para consumir el Core desde el panel y plugins. Expone tipos: Theme, StyleToken, ComponentVariant, ThemeVersion, utilidades de X-Tenant-Id y auth.

---

# ‚úÖ Checklist ‚Äî 0) Preparativos de Base

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Infra Frontend

* [ ] **Crear app Admin** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Inicializa Next.js 14 con TypeScript en `/apps/gadmin` (monorepo PNPM). A√±ade Tailwind y shadcn/ui.

  * Sub-tareas:
    * [ ] `pnpm dlx create-next-app@latest gadmin --ts --eslint --app --src-dir --import-alias "@/*" --use-pnpm`
    * [ ] `pnpm -F gadmin add tailwindcss postcss autoprefixer @radix-ui/react-icons class-variance-authority tailwind-merge lucide-react`
    * [ ] `pnpm -F gadmin dlx shadcn@latest init` (y configura base)
    * [ ] Crear `app/(admin)/layout.tsx` con **Shell** (Sidebar + Topbar)
    * [ ] A√±adir `theme-provider` (dark/light, CSS variables)
* [ ] **Layout & rutas m√≠nimas** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Crea p√°ginas protegidas `/admin/theme` y `/admin/style` (TBD dentro) con layout consistente.

  * Sub-tareas:
    * [ ] `app/(admin)/theme/page.tsx` y `app/(admin)/style/page.tsx`
    * [ ] Barra lateral con links (oculta por rol)
    * [ ] Estados `loading.tsx` y `error.tsx`
* [ ] **Auth contra Core** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Pantalla `/login`, llamada a `/v1/auth/login`, almacenamiento de **access** y **refresh**; refresh autom√°tico; logout.

  * Sub-tareas:
    * [ ] Servicio `authClient` con `login/refresh/logout`
    * [ ] Guarda tokens en **cookies httpOnly** v√≠a API route (`/api/session`) o, si no usas cookies, en `memory + secure storage` (evitar `localStorage` si es posible)
    * [ ] Interceptor fetch que a√±ade `Authorization: Bearer`
* [ ] **Inyecci√≥n de `X-Tenant-Id`** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Selector de tenant en Topbar + middleware/interceptor que a√±ade la cabecera en **todas** las requests.

  * Sub-tareas:
    * [ ] Contexto `TenantContext` + `useTenant()`
    * [ ] `apiFetch` centralizado que adjunta `X-Tenant-Id`
* [ ] **i18n base** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Configura internacionalizaci√≥n (por ejemplo `next-intl` o `next-i18next`) con `es` y `en`, soporte RTL preparado.

  * Sub-tareas:
    * [ ] Archivos de mensajes `/locales/{en,es}.json`
    * [ ] Switch de idioma en Topbar
* [ ] **Verificaci√≥n A (Infra)** ‚Äî *checkpoint*:

  * [ ] Puedes iniciar sesi√≥n y ver `/admin/theme` y `/admin/style` con layout cargado
  * [ ] Las requests muestran `Authorization` y `X-Tenant-Id` en el network inspector
  * [ ] Cambiar idioma actualiza textos sin recargar (SSR/CSR coherente)

---

### B. SDK & Tipos

* [ ] **Cliente OpenAPI** ‚Äî *m√≥dulo*: `plugin-sdk` ¬∑ *tarea t√©cnica*: Genera cliente TypeScript desde `openapi.json` del Core; publicar como paquete interno del monorepo.

  * Sub-tareas:
    * [ ] `pnpm -w add -D openapi-typescript`
    * [ ] Script `pnpm gen:sdk` ‚Üí genera tipos y cliente (`/packages/plugin-sdk`)
    * [ ] Exporta tipos: `Theme`, `StyleToken`, `ComponentVariant`, `ThemeVersion`
* [ ] **Helper de fetch** ‚Äî *m√≥dulo*: `plugin-sdk` ¬∑ *tarea t√©cnica*: `createApiClient({ baseUrl, getAccessToken, getTenantId })` que a√±ade `Authorization` y `X-Tenant-Id`, maneja **401** con refresh y propaga errores tipados `{code,message,details}`.
* [ ] **Path alias & consumo** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Importa el SDK con alias `@g/sdk` y usa en una llamada de prueba (p.ej. `/v1/health` o `/v1/themes`).
* [ ] **Verificaci√≥n B (SDK)** ‚Äî *checkpoint*:

  * [ ] `@g/sdk` se usa desde `gAdmin` sin tipos `any`
  * [ ] Un `fetch` real al Core responde 200 y muestra headers correctos
  * [ ] Errores 401/403 se muestran con mensaje y no rompen la app

---

### C. RBAC en el Admin

* [ ] **Matriz de permisos** ‚Äî *m√≥dulo*: `gAuth/gMemberships` ¬∑ *tarea t√©cnica*: Define mapping UI ‚Üí permisos:

  * OWNER/ADMIN: **crear/editar/aplicar** temas/estilos
  * REVIEWER: **aprobar/publicar**
  * EDITOR: **aplicar** (sin crear/editar)
  * VIEWER: **solo lectura**
* [ ] **Protecci√≥n de rutas** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Middleware/HOC `withRole` que exige rol m√≠nimo para cada ruta.
* [ ] **UI consciente de rol** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Oculta botones y acciones seg√∫n permisos; p√°gina `/admin/403` para denegados.
* [ ] **Verificaci√≥n C (RBAC)** ‚Äî *checkpoint*:

  * [ ] Usuario VIEWER ve p√°ginas pero no botones de **Guardar/Aplicar**
  * [ ] Acceso directo a `/admin/style` como VIEWER devuelve 403
  * [ ] OWNER puede acceder y ver controles completos

---

### D. Configuraci√≥n DevOps base

* [ ] **Variables de entorno** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: `.env.example` con `NEXT_PUBLIC_API_URL`, `TENANT_HEADER=X-Tenant-Id`; val√≠dalas (zod/schemas).
* [ ] **Lint/format/test** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: ESLint + Prettier + Jest/RTL m√≠nimos; script `pnpm test`.
* [ ] **CI b√°sico** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Workflow GitHub Actions: setup pnpm, install, build, test; cache.
* [ ] **Verificaci√≥n D (DevOps)** ‚Äî *checkpoint*:

  * [ ] `pnpm build` y `pnpm test` verdes en local y CI
  * [ ] Cambiar `NEXT_PUBLIC_API_URL` no rompe; tipos siguen estrictos

---

### E. DoD (Definition of Done) de la Secci√≥n 0

* [ ] Inicio de sesi√≥n funcional; tokens gestionados; refresh OK
* [ ] `X-Tenant-Id` se adjunta en todas las requests
* [ ] Rutas `/admin/theme` y `/admin/style` protegidas y visibles seg√∫n rol
* [ ] SDK instalado y consumido con tipos correctos
* [ ] Checks i18n b√°sicos (EN/ES); switch operativo
* [ ] CI ejecuta build y tests; `.env.example` actualizado


# ‚úÖ Checklist ‚Äî 1) Dise√±o de Design Tokens (base visual)

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Schema de Tokens

* [ ] **Definir contrato JSON** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea t√©cnica*: Especifica un schema con Zod/Joi para los grupos principales:

  * [ ] `color.{primary,secondary,accent,background,foreground,success,warning,danger,muted}`
  * [ ] `typography.{fontFamily, fontSizeScale, lineHeight, fontWeight}`
  * [ ] `space.{xs,sm,md,lg,xl,2xl,...}`
  * [ ] `radius.{sm,md,lg,full}`
  * [ ] `shadow.{sm,md,lg,xl}`
  * [ ] `zIndex.{modal,overlay,dropdown,sticky}`
  * [ ] `opacity.{disabled,hover,focus}`
  * [ ] `transition.{fast,normal,slow}`
  * [ ] `breakpoints.{sm,md,lg,xl,2xl}`
  * [ ] `focusRing` (color, grosor, offset)
* [ ] **Validaci√≥n estricta** ‚Äî error 400 si faltan claves obligatorias o si valores son inv√°lidos (ej. `#XYZ123`).
* [ ] **Documentar schema** ‚Äî agrega ejemplos en Swagger/OpenAPI.

### B. Fuentes & Iconos

* [ ] **Google Fonts** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea t√©cnica*: Permite elegir tipograf√≠as de Google Fonts (con subset, weights, display=swap).
* [ ] **Fuentes Custom** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea*: subida de archivos `.woff2` al bucket/DB y registro en tema.
* [ ] **Packs de Iconos** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea*: soporta packs Lucide, Font Awesome; tree-shaking para importar solo √≠conos usados.
* [ ] **Verificaci√≥n B (Fonts & Icons)**:

  * [ ] Seleccionar ‚ÄúRoboto‚Äù cambia la fuente global
  * [ ] Subir una fuente custom la activa sin romper
  * [ ] Elegir pack Lucide permite usar √≠conos en botones/cards

### C. Binding a Tailwind

* [ ] **CSS Variables** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: Mapear tokens a variables CSS `--color-primary`, `--space-md`, etc.
* [ ] **Config extendida** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: Extiende `tailwind.config.ts` con `theme.extend.colors = "var(--color-primary)"`.
* [ ] **Scope por tenant** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: Encapsula variables por `data-tenant` en `<html>` para aislar tenants.
* [ ] **Verificaci√≥n C (Tailwind binding)**:

  * [ ] Cambiar color primario en el editor refleja cambio en botones/cards
  * [ ] En DevTools aparecen las variables `--color-*` por tenant

### D. Editor de Tokens (UI)

* [ ] **Pantalla de edici√≥n** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: UI para seleccionar colores, tipograf√≠as, espaciados, radios, sombras.
* [ ] **Previsualizaci√≥n instant√°nea** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: componente live preview que refleja cambios de tokens al vuelo.
* [ ] **Resets & defaults** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: bot√≥n ‚ÄúReset‚Äù y carga de presets por defecto (ej. tema light/dark base).
* [ ] **Accesibilidad** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: incluir checker de contraste en colores y preview de texto m√≠nimo WCAG.
* [ ] **Verificaci√≥n D (Editor UI)**:

  * [ ] Guardar tokens actualiza DB y CSS variables
  * [ ] Cambiar tipograf√≠a en editor actualiza t√≠tulos/p√°rrafos en preview
  * [ ] El checker de contraste avisa si color primario vs background < AA

### E. DoD (Definition of Done) de la Secci√≥n 1

* [ ] Schema definido y validado en Core
* [ ] Tokens persisten y son consumidos por Tailwind + CSS variables
* [ ] Editor UI en Admin funciona con preview instant√°nea
* [ ] Fuentes e √≠conos configurables, subidas y reflejadas en UI
* [ ] Checkpoints de accesibilidad (contraste AA m√≠nimo) validados


# ‚úÖ Checklist ‚Äî 2) **gTheme**: CRUD, Versionado y Activaci√≥n por Tenant

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Modelo y Migraciones

* [ ] **Entidad Theme** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea t√©cnica*: `Theme { id(uuid), tenantId(uuid|null para global), name, description, tags[string[]], tokens(jsonb), status('draft'|'published'|'archived'), version(int), createdAt, updatedAt, publishedAt|null, createdBy, updatedBy }`.
* [ ] **√çndices** ‚Äî *tarea*: `tenantId+status`, `name trigram`, `createdAt desc`.
* [ ] **Hist√≥rico** ‚Äî *tarea*: tabla `ThemeVersion { id, themeId, version, tokens, changelog, createdAt, createdBy }`.
* [ ] **Migraci√≥n** ‚Äî *tarea*: generar y aplicar migraci√≥n TypeORM.
* [ ] **Checkpoint A**: DB contiene `themes` y `theme_versions`; `tokens` acepta JSON v√°lido seg√∫n schema de Secci√≥n 1.

### B. API/DTOs y Validaci√≥n

* [ ] **DTO Create/Update** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea t√©cnica*: `CreateThemeDto { tenantId|null, name, description?, tags?, tokens: ThemeTokens }`, `UpdateThemeDto { name?, description?, tags?, tokens? }` con class-validator/zod.
* [ ] **Rutas** ‚Äî *tarea*:

  * [ ] `POST /v1/themes` (crear)
  * [ ] `GET /v1/themes?tenantId=&q=&status=&limit=&cursor=` (listar + b√∫squeda)
  * [ ] `GET /v1/themes/:id` (detalle)
  * [ ] `PATCH /v1/themes/:id` (editar)
  * [ ] `DELETE /v1/themes/:id` (soft-delete ‚Üí status `archived`)
  * [ ] `POST /v1/themes/:id/clone` (clonar)
* [ ] **Guardas** ‚Äî *tarea*: Auth + TenantGuard + RBAC (OWNER/ADMIN crear/editar/borrar; VIEWER solo GET).
* [ ] **Checkpoint B**: Swagger muestra esquemas; validaci√≥n rechaza tokens fuera de schema; 403 si rol insuficiente.

### C. Versionado & Diff

* [ ] **Snapshot** ‚Äî *tarea t√©cnica*: al `PATCH` que modifique `tokens`, crear entrada en `ThemeVersion` con `version = (prev + 1)` y `changelog` opcional.
* [ ] **Diff service** ‚Äî *tarea*: generar diff de `tokens` (keys cambiadas, a√±adidas, removidas) para UI.
* [ ] **Rollback** ‚Äî *tarea*: `POST /v1/themes/:id/rollback/:version` que reemplace `tokens` y cree nueva versi√≥n +1 con `changelog="rollback to vX"`.
* [ ] **Checkpoint C**: editar tema crea `v2`; rollback a `v1` restaura exactamente los tokens; auditor√≠a registra antes/despu√©s (sin secretos).

### D. Activaci√≥n por Tenant (tema activo)

* [ ] **Campo activo** ‚Äî *opci√≥n 1*: `Tenant.themeIdActive` en tabla tenants.
* [ ] **Rutas** ‚Äî *tarea*: `POST /v1/tenants/:tenantId/theme/activate` body `{ themeId }`.
* [ ] **Cascada de modos** ‚Äî *tarea*: soportar `light/dark` dentro de `tokens`; cabecera/env que permita ‚Äúprefer-color-scheme‚Äù.
* [ ] **Invalidaci√≥n de cache** ‚Äî *tarea*: emitir **DomainEvent** `theme.activated` ‚Üí que dispare revalidaciones/ISR/caches.
* [ ] **Checkpoint D**: activar un tema cambia variables CSS para ese tenant; SSR/ISR revalida p√°ginas; no afecta otros tenants.

### E. Flujo de Publicaci√≥n (Draft ‚Üí Review ‚Üí Published)

* [ ] **Estados** ‚Äî *tarea t√©cnica*: `status` del theme: `draft` (editable), `published` (solo cambio v√≠a nueva versi√≥n), `archived`.
* [ ] **Aprobaciones** ‚Äî *tarea*: `POST /v1/themes/:id/request-review`, `POST /v1/themes/:id/approve`, `POST /v1/themes/:id/publish`. Roles: REVIEWER aprueba, OWNER/ADMIN publica.
* [ ] **Comentarios** ‚Äî *tarea*: `ThemeReview { id, themeId, comment, authorId, createdAt }`.
* [ ] **Checkpoint E**: un EDITOR no puede publicar; REVIEWER aprueba; al publicar se sella `publishedAt` y se bloquea edici√≥n directa (solo nueva versi√≥n).

### F. UI en gAdmin (CRUD + Versiones + Activaci√≥n)

* [ ] **Listado** ‚Äî *tarea t√©cnica*: `/admin/theme` con tabla (nombre, estado, versi√≥n, actualizado, acciones). B√∫squeda por nombre/tags; filtros por estado.
* [ ] **Editor** ‚Äî *tarea*: `/admin/theme/:id` con tabs: *Tokens* (de Secci√≥n 1), *Versiones* (historial con diff), *Revisi√≥n* (comentarios), *Publicaci√≥n*, *Activaci√≥n*.
* [ ] **Clonar/Crear** ‚Äî *tarea*: wizard con presets (Light/Dark) y plantilla vac√≠a.
* [ ] **Activar** ‚Äî *tarea*: bot√≥n ‚ÄúActivar en este tenant‚Äù (muestra tenant actual en Topbar).
* [ ] **Checkpoint F**: desde la UI se puede crear, clonar, editar, versionar, publicar y activar un tema en < 3 clics por paso; errores se muestran tipados.

### G. Auditor√≠a, Seguridad y Errores

* [ ] **AuditLog** ‚Äî *tarea t√©cnica*: registra `THEME_CREATED`, `THEME_UPDATED`, `THEME_VERSIONED`, `THEME_ROLLBACK`, `THEME_PUBLISHED`, `THEME_ACTIVATED` (actor, tenant, themeId, version, diff resumido).
* [ ] **Rate limit + Idempotency** ‚Äî *tarea*: aplica buckets a `publish/activate`; idempotencia en `approve/publish` para evitar doble click.
* [ ] **Errores tipados** ‚Äî *tarea*: `ERR_THEME_NOT_FOUND`, `ERR_THEME_INVALID_TOKENS`, `ERR_THEME_ROLLBACK_VERSION`, `ERR_THEME_FORBIDDEN`.
* [ ] **Checkpoint G**: logs de auditor√≠a visibles en visor; errores devuelven c√≥digo + mensaje coherente; 429 si se abusa de publish.

### H. Pruebas

* [ ] **Unit** ‚Äî *tarea t√©cnica*: servicios `ThemeService`, `ThemeVersionService`, `ThemeDiffService`.
* [ ] **E2E** ‚Äî *tarea*:

  * [ ] Crear ‚Üí Editar tokens ‚Üí Versionar (v1‚Üív2)
  * [ ] Rollback a v1
  * [ ] Publicar y bloquear edici√≥n directa
  * [ ] Activar en tenant A (no afecta tenant B)
  * [ ] 403 por rol insuficiente (VIEWER/EDITOR)
* [ ] **Performance smoke** ‚Äî *tarea*: payload `tokens` grande (p.ej. 50KB) <-> DB ok, sin timeouts.
* [ ] **Checkpoint H**: suite e2e verde; cobertura m√≠nima (funcs 70%+).

### I. DoD (Definition of Done) Secci√≥n 2

* [ ] CRUD de temas operativo con validaci√≥n estricta
* [ ] Versionado con historial y **rollback** funcional
* [ ] Flujo de publicaci√≥n con aprobaciones y auditor√≠a
* [ ] Activaci√≥n por tenant con inval. de cache/ISR
* [ ] UI gAdmin permite todo el ciclo (crear‚Üípublicar‚Üíactivar)
* [ ] Pruebas unit/e2e y errores tipados implementados

# ‚úÖ Checklist ‚Äî 3) **gStyle**: Variantes de Componentes (UI System)

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Modelo y Migraciones

* [ ] **Entidad StyleComponent** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: `StyleComponent { id(uuid), tenantId(uuid|null global), key(text, p.ej. 'button', 'table'), description?, createdAt, updatedAt }`.
* [ ] **Entidad StyleVariant** ‚Äî *tarea*: `StyleVariant { id(uuid), componentId, name(text p.ej. 'primary'), tokens(jsonb), states(jsonb: {hover,focus,active,disabled}), size('sm'|'md'|'lg'|custom?), isDefault(boolean), createdAt, updatedAt, createdBy, updatedBy }`.
* [ ] **√çndices** ‚Äî *tarea*: `tenantId+key` √∫nico, `componentId+name` √∫nico.
* [ ] **Migraciones** ‚Äî *tarea*: generar y aplicar migraciones TypeORM.
* [ ] **Checkpoint A**: tablas creadas; constraints √∫nicos funcionan; `tokens` acepta JSON v√°lido.

### B. Mapa de Componentes y Cat√°logo Base

* [ ] **Cat√°logo inicial** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea*: registrar componentes base: `button, input, textarea, select, checkbox, radio, switch, badge, tag, alert, tooltip, modal, drawer, tabs, accordion, card, table, pagination, navbar, sidebar, footer, hero, section, cta`.
* [ ] **Sem√°ntica** ‚Äî *tarea*: documentar props m√≠nimas por componente (p.ej. button: `variant`, `size`, `icon`, `loading`).
* [ ] **Seeder opcional** ‚Äî *tarea*: crear variantes por defecto (p.ej. `button.primary`, `button.secondary`, `table.striped`).
* [ ] **Checkpoint B**: endpoint `GET /v1/styles/components` devuelve cat√°logo; variantes por defecto disponibles.

### C. Tokens de Componente (derivaci√≥n desde gTheme)

* [ ] **Derivaci√≥n** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: servicio que traduce tokens de `gTheme` ‚Üí *component tokens* (p.ej., `button.bg = color.primary`, `button.radius = radius.md`, `button.font = typography.body`).
* [ ] **Overrides** ‚Äî *tarea*: permitir overrides por variante (solo whitelisted keys); merge determinista y seguro.
* [ ] **Validaci√≥n** ‚Äî *tarea*: schema de `StyleVariantTokens` (colores, espaciados, radios, sombras, borderWidth, fontWeight, gap, iconSpacing, focusRing).
* [ ] **Checkpoint C**: cambiar `color.primary` en `gTheme` repercute en `button.primary` salvo override expl√≠cito.

### D. API/DTOs y Rutas

* [ ] **DTOs** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: `CreateComponentDto`, `CreateVariantDto { componentKey, name, tokens?, states?, size?, isDefault? }`, `UpdateVariantDto`.
* [ ] **Rutas** ‚Äî *tarea*:

  * [ ] `GET /v1/styles/components`
  * [ ] `POST /v1/styles/components` (crear componente custom, opcional)
  * [ ] `GET /v1/styles/components/:key/variants`
  * [ ] `POST /v1/styles/variants` (crear variante)
  * [ ] `PATCH /v1/styles/variants/:id` (editar)
  * [ ] `DELETE /v1/styles/variants/:id` (soft-delete)
  * [ ] `POST /v1/styles/variants/:id/clone`
  * [ ] `POST /v1/styles/variants/:id/set-default`
* [ ] **Guardas** ‚Äî *tarea*: Auth + TenantGuard + RBAC (OWNER/ADMIN crear/editar/borrar; EDITOR aplicar; REVIEWER aprobar publicaci√≥n si aplica).
* [ ] **Checkpoint D**: Swagger muestra esquemas; crear/editar/borrar variante funciona y respeta permisos.

### E. Editor WYSIWYG de Variantes

* [ ] **UI Editor** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: `/admin/style` con tabs: *Componentes*, *Variantes*, *Previsualizaci√≥n*.
* [ ] **State toggles** ‚Äî *tarea*: toggles para `hover/focus/active/disabled`, tama√±os `sm/md/lg`, densidad, con/sin icono, loading.
* [ ] **Live Preview** ‚Äî *tarea*: muestra el componente real con tokens aplicados; compara lado a lado *default vs editado*.
* [ ] **Accesibilidad** ‚Äî *tarea*: contraste AA/AAA, radio m√≠nimo t√°ctil (44px), focus ring configurable, navegaci√≥n por teclado.
* [ ] **Checkpoint E**: crear `button.primary`, ajustar radius/colores, ver cambios al vuelo y pasar checker AA.

### F. Aplicaci√≥n Global y Resoluci√≥n de Precedencias

* [ ] **Prioridades** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: orden de merge: `theme tokens` ‚Üí `component tokens` ‚Üí `variant overrides` ‚Üí `context overrides` (m√≥dulo/p√°gina).
* [ ] **Context maps** ‚Äî *tarea*: mapear variante por contexto (p.ej. ‚Äúen Admin, los botones por defecto usan `primary`‚Äù).
* [ ] **Per-page (opcional)** ‚Äî *m√≥dulo*: `gPages/gStyle` ¬∑ *tarea*: permitir override de una variante en una p√°gina concreta (guardado en Page JSON).
* [ ] **Checkpoint F**: cambiar el ‚Äúdefault‚Äù de `button` actualiza botones en Admin y CMS sin romper otras vistas; inspecci√≥n muestra procedencia de estilos.

### G. Integraci√≥n con Tailwind/CSS Variables

* [ ] **Variables din√°micas** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: exportar tokens/variantes a CSS variables `--g-button-bg`, `--g-card-radius`.
* [ ] **Utilities** ‚Äî *tarea*: helpers/`cva()` para construir clases desde tokens; evitar clases conflictivas.
* [ ] **RTL ready** ‚Äî *tarea*: soporte direccionalidad (m√°rgenes invertidos, iconos espejados si procede).
* [ ] **Checkpoint G**: cambiar `--g-button-bg` en runtime refleja inmediatamente el estilo en preview.

### H. Seguridad & Sanitizaci√≥n

* [ ] **Whitelist valores** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: listas permitidas para colores (hex/rgb/hsl), unidades (px, rem, %), bordes, sombras; bloquear expresiones CSS peligrosas.
* [ ] **CSP-aware** ‚Äî *tarea*: no inyectar `style` inline salvo con `nonce` y solo si est√° habilitado; preferir clases/variables.
* [ ] **Rate limit/Idempotency** ‚Äî *tarea*: aplicar a crear/editar variantes para evitar spam/doble click.
* [ ] **Checkpoint H**: pruebas negativas de XSS/CSS injection fallan con 400; CSP sin violaciones.

### I. Accesibilidad (a11y)

* [ ] **Contraste** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: validador AA/AAA en combinaciones foreground/background.
* [ ] **Focus y teclado** ‚Äî *tarea*: todos los componentes tienen foco visible y orden l√≥gico; probar con *tab/shift+tab/enter/esc*.
* [ ] **Tama√±o interactivo** ‚Äî *tarea*: controles t√°ctiles ‚â• 44px; tooltips accesibles (ARIA).
* [ ] **Checkpoint I**: Lighthouse a11y ‚â• 95 en la p√°gina de preview de estilos.

### J. UI en gAdmin (Cat√°logo + CRUD + Preview)

* [ ] **Listado de componentes** ‚Äî *tarea t√©cnica*: tabla de componentes y contador de variantes; filtros/b√∫squeda.
* [ ] **CRUD variantes** ‚Äî *tarea*: formulario con validaci√≥n en tiempo real, bot√≥n ‚ÄúClonar‚Äù, ‚ÄúSet default‚Äù.
* [ ] **Preview Matrix** ‚Äî *tarea*: grid que muestra (variant √ó size √ó state).
* [ ] **Historial y notas** ‚Äî *tarea*: notas por variante (intenci√≥n de dise√±o), qui√©n edit√≥ y cu√°ndo.
* [ ] **Checkpoint J**: crear ‚Üí clonar ‚Üí set default ‚Üí ver reflejo global; undo/rollback simple v√≠a historial.

### K. Auditor√≠a, Errores Tipados

* [ ] **AuditLog** ‚Äî *m√≥dulo*: `gAdmin/gStyle` ¬∑ *tarea t√©cnica*: registra `STYLE_COMPONENT_CREATED`, `STYLE_VARIANT_CREATED/UPDATED/DELETED`, `STYLE_VARIANT_SET_DEFAULT`, con diff breve.
* [ ] **Errores** ‚Äî *tarea*: `ERR_STYLE_COMPONENT_EXISTS`, `ERR_STYLE_VARIANT_CONFLICT`, `ERR_STYLE_INVALID_TOKENS`, `ERR_STYLE_FORBIDDEN`.
* [ ] **Checkpoint K**: auditor√≠a visible en visor; errores coherentes en API/UI.

### L. Pruebas

* [ ] **Unit** ‚Äî *tarea t√©cnica*: `StyleService`, `VariantService`, `ResolveService`, `Sanitizer`, `ContrastChecker`.
* [ ] **E2E** ‚Äî *tarea*:

  * [ ] Crear componente/variante y set default
  * [ ] Clonar variante y editar tokens
  * [ ] Validar precedencias (context override)
  * [ ] Acceso/403 por rol
  * [ ] XSS/CSS injection negativo
* [ ] **Performance smoke** ‚Äî *tarea*: muchas variantes (p.ej. 200) cargan sin timeouts; render de preview < 200ms mediana.
* [ ] **Checkpoint L**: suites verde; cobertura m√≠nima (funcs 70%+).

### M. DoD (Definition of Done) Secci√≥n 3

* [ ] Cat√°logo de componentes y variantes CRUD operativo
* [ ] Derivaci√≥n de tokens desde `gTheme` con overrides seguros
* [ ] Editor WYSIWYG con preview y validaciones a11y
* [ ] Resoluci√≥n de precedencias y context mapping funcional
* [ ] Seguridad (sanitizaci√≥n/CSP) y errores tipados
* [ ] Pruebas unitarias y e2e cubren el ciclo completo

# ‚úÖ Checklist ‚Äî 4) Aplicaci√≥n, Herencia y Precedencias

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Motor de Resoluci√≥n de Estilos

* [ ] **Servicio Resolver** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: implementar `resolveStyle(componentKey, context?)` que combine:

  1. `theme tokens` (base)
  2. `component tokens` (defaults por componente)
  3. `variant overrides` (definidos en `StyleVariant`)
  4. `contextual overrides` (opcional: per-m√≥dulo o per-p√°gina).
* [ ] **Determinismo** ‚Äî *tarea*: garantizar orden de precedencia estable (√∫ltimo en la cadena sobrescribe).
* [ ] **Cache interna** ‚Äî *tarea*: memoizaci√≥n por tenant + tema activo para reducir c√°lculos.
* [ ] **Checkpoint A**: cambiar un token de theme ‚Üí resolver refleja cambio en todas las variantes sin overrides; inspecci√≥n devuelve √°rbol de origen.

### B. Context Mapping (per-m√≥dulo/per-secci√≥n)

* [ ] **Entidad ContextMap** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: `ContextMap { id, tenantId, contextKey (ej: 'admin', 'cms', 'checkout'), componentKey, variantId }`.
* [ ] **CRUD ContextMap** ‚Äî *tarea*: endpoints para asignar variantes a contextos espec√≠ficos.
* [ ] **UI** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: vista de mapeo: seleccionar ‚Äúen CMS ‚Üí usar `button.secondary`‚Äù.
* [ ] **Checkpoint B**: un bot√≥n en Admin usa `primary`; en CMS usa `secondary` sin romper otros contextos.

### C. Overrides por P√°gina (opcional, gPages)

* [ ] **Soporte JSON overrides** ‚Äî *m√≥dulo*: `gPages/gStyle` ¬∑ *tarea t√©cnica*: permitir en Page JSON un bloque `styleOverrides` con pares `componentKey.variantName ‚Üí tokens`.
* [ ] **Validaci√≥n fuerte** ‚Äî *tarea*: schema limita overrides a propiedades whitelisted.
* [ ] **UI Editor** ‚Äî *tarea*: toggle ‚Äúoverride local‚Äù en Page Builder con advertencia de deuda t√©cnica.
* [ ] **Checkpoint C**: una Landing Page puede forzar `hero.bg = color.special`; rollback elimina override y vuelve a herencia normal.

### D. Visual Inspector (Debug)

* [ ] **DevTools interno** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: en modo preview, click en un componente abre ‚ÄúInspector‚Äù con detalle: `theme ‚Üí component ‚Üí variant ‚Üí override`.
* [ ] **Highlight visual** ‚Äî *tarea*: resaltar la fuente del estilo aplicado.
* [ ] **Checkpoint D**: un desarrollador puede ver en la UI de preview de d√≥nde proviene cada valor.

### E. Persistencia y Auditor√≠a

* [ ] **AuditLog** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea*: registrar cambios en `ContextMap` y overrides por p√°gina (`STYLE_CONTEXTMAP_UPDATED`, `STYLE_PAGE_OVERRIDE_ADDED`).
* [ ] **Rollback** ‚Äî *tarea*: rollback granular por contexto/p√°gina desde auditor√≠a.
* [ ] **Checkpoint E**: eliminar un override desde auditor√≠a restaura estilos previos sin inconsistencias.

### F. Seguridad y Consistencia

* [ ] **Restringir contexts** ‚Äî *tarea*: lista blanca de contextKeys (`admin`, `cms`, `store`, `landing`, etc.) para evitar colisiones.
* [ ] **Limitar overrides** ‚Äî *tarea*: m√°ximo n¬∫ de overrides por p√°gina/contexto configurable.
* [ ] **Idempotency** ‚Äî *tarea*: POST de contextMap/override protegido por Idempotency-Key.
* [ ] **Checkpoint F**: intento duplicado de override devuelve 409 Conflict; sin duplicados.

### G. Integraci√≥n con gTheme

* [ ] **Suscripci√≥n a eventos** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: cuando un tema cambia, recalcular variantes y context maps dependientes.
* [ ] **Propagaci√≥n** ‚Äî *tarea*: invalidar cache de `resolveStyle` al activar nuevo tema.
* [ ] **Checkpoint G**: activar nuevo tema cambia autom√°ticamente todos los contextos; no requiere limpiar manualmente.

### H. Pruebas

* [ ] **Unit** ‚Äî *tarea*: pruebas de `resolveStyle`, `ContextMapService`, `PageOverrideService`.
* [ ] **E2E** ‚Äî *tarea*:

  * [ ] Cambiar token base repercute en todas las variantes.
  * [ ] Context map distinto para Admin y CMS.
  * [ ] Override local en p√°gina respeta l√≠mites.
  * [ ] Audit rollback restaura estilos.
* [ ] **Carga** ‚Äî *tarea*: probar 1000 resoluciones seguidas < 100ms mediana.
* [ ] **Checkpoint H**: suites verdes, cobertura >75%.

### I. DoD (Definition of Done) Secci√≥n 4

* [ ] Motor `resolveStyle` implementado con precedencia clara.
* [ ] ContextMap funcional con UI y auditor√≠a.
* [ ] Overrides por p√°gina opcionales, seguros y reversibles.
* [ ] Inspector visual muestra herencia y fuente.
* [ ] Pruebas unitarias + e2e completas, rendimiento validado.

# ‚úÖ Checklist ‚Äî 5) Contenidos de Referencia (P√°ginas Demo)

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Plantillas de Demo

* [ ] **Entidad DemoPage** ‚Äî *m√≥dulo*: `gPages` ¬∑ *tarea t√©cnica*: definir tabla/JSON `DemoPage { id, tenantId, slug, blocks[] }` para p√°ginas de referencia.
* [ ] **Set inicial de plantillas** ‚Äî *tarea*: crear p√°ginas predefinidas: **Landing**, **About**, **Pricing**, **Blog Post**, **Dashboard b√°sico**.
* [ ] **UI de selecci√≥n** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: men√∫ `/admin/demo` para previsualizar plantillas.
* [ ] **Checkpoint A**: render de `/admin/demo/landing` muestra hero, CTA y botones aplicando tokens/variantes activos.

### B. Bloques Compatibles

* [ ] **Definir cat√°logo de bloques** ‚Äî *m√≥dulo*: `gPages` ¬∑ *tarea*: componentes reutilizables (Hero, FAQ, Pricing Table, Contact Form, Feature Grid, Testimonial, BlogList, Footer).
* [ ] **Integraci√≥n con gStyle** ‚Äî *tarea*: cada bloque consume `resolveStyle` para tokens/variantes (ej. `button.primary`, `card.shadow.md`).
* [ ] **Drag & Drop (fase 2)** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: habilitar edici√≥n de orden de bloques para demo pages.
* [ ] **Checkpoint B**: editar estilo de `button.primary` se refleja en todos los bloques de demo instant√°neamente.

### C. Data de Mock Multiling√ºe

* [ ] **Dataset semilla** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: textos cortos/largos, precios ficticios, FAQs, posts dummy.
* [ ] **i18n** ‚Äî *tarea*: proveer traducciones (EN, ES, FR) con alternancia en runtime.
* [ ] **Media placeholders** ‚Äî *tarea*: im√°genes SVG/Unsplash placeholders para consistencia visual.
* [ ] **Checkpoint C**: cambiar idioma de demo page ‚Üí textos e im√°genes cambian sin romper layout.

### D. Validaci√≥n Visual & T√©cnica

* [ ] **SSR/CSR consistency** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: asegurar que el render inicial (SSR) y el hidrato (CSR) no producen saltos de contenido (*no content jumps*).
* [ ] **Preview aislado** ‚Äî *tarea*: `/admin/demo/:slug?preview=true` genera iframe sandbox.
* [ ] **Accesibilidad base** ‚Äî *tarea*: usar `aria-*`, roles, foco visible en todos los bloques demo.
* [ ] **Checkpoint D**: Lighthouse en demo pages ‚â• 95 en **SEO** y **A11y**.

### E. Auditor√≠a y Persistencia

* [ ] **AuditLog** ‚Äî *m√≥dulo*: `gPages` ¬∑ *tarea*: registrar creaci√≥n/edici√≥n de demo pages y bloques (`DEMO_PAGE_UPDATED`).
* [ ] **Rollback demo** ‚Äî *tarea*: permitir restaurar plantillas a estado base.
* [ ] **Checkpoint E**: rollback de Landing Page demo devuelve al dise√±o inicial con tokens actuales aplicados.

### F. Pruebas

* [ ] **Unit tests** ‚Äî *tarea*: validar que cada bloque usa `resolveStyle`.
* [ ] **E2E tests** ‚Äî *tarea*:

  * [ ] Crear demo Landing.
  * [ ] Cambiar color primario en `gTheme`.
  * [ ] Refrescar ‚Üí hero/CTA reflejan nuevo color.
  * [ ] Cambiar idioma ‚Üí contenido se traduce.
* [ ] **Carga** ‚Äî *tarea*: stress test con 50 bloques por p√°gina < 1s render SSR.
* [ ] **Checkpoint F**: suites verdes, cobertura >75%.

### G. DoD (Definition of Done) Secci√≥n 5

* [ ] P√°ginas demo operativas con bloques vinculados a tokens/variantes.
* [ ] Data de mock multiling√ºe funcional.
* [ ] Validaciones SEO + A11y con Lighthouse ‚â• 95.
* [ ] Auditor√≠a activa y rollback disponible.
* [ ] Pruebas unit + e2e completas.

# ‚úÖ Checklist ‚Äî 6) Previsualizaci√≥n, Borradores y Publicaci√≥n

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Sandbox / Preview

* [ ] **Preview token** ‚Äî *m√≥dulo*: `gAuth/gTheme/gStyle` ¬∑ *tarea t√©cnica*: generar `previewToken` temporal firmado (JWT corto) para aislar previsualizaci√≥n.
* [ ] **Iframe sandbox** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: renderizar preview en iframe con `?previewToken=...`, sin afectar prod.
* [ ] **Expiraci√≥n** ‚Äî *tarea*: tokens caducan en minutos; accesos caducados ‚Üí 401.
* [ ] **Checkpoint A**: abrir `/admin/theme/preview` muestra cambios no publicados sin afectar usuarios finales.

### B. Estado Draft / Review / Publish

* [ ] **Estado de entidades** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea*: agregar campo `status ‚àà {draft, review, published}` a temas y estilos.
* [ ] **Transici√≥n de estados** ‚Äî *tarea*: OWNER/ADMIN pueden mover de draft‚Üíreview; REVIEWER aprueba y pasa a published.
* [ ] **Comentarios inline** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: interfaz para comentarios en cambios de tokens/variantes.
* [ ] **Audit log** ‚Äî *tarea*: cada transici√≥n se registra (`THEME_REVIEW_REQUESTED`, `THEME_PUBLISHED`).
* [ ] **Checkpoint B**: un EDITOR crea tema draft; REVIEWER lo aprueba; OWNER lo publica ‚Üí visible para tenant.

### C. Programaci√≥n de Publicaci√≥n

* [ ] **Campo scheduledAt** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea*: permitir programar publicaci√≥n con timestamp.
* [ ] **Worker de jobs** ‚Äî *m√≥dulo*: `JobsModule` ¬∑ *tarea*: job que activa tema/estilo en hora programada.
* [ ] **UI de scheduling** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: selector de fecha/hora con zona horaria tenant.
* [ ] **Checkpoint C**: programar publicaci√≥n para ma√±ana ‚Üí job aplica autom√°ticamente sin intervenci√≥n manual.

### D. Rollback

* [ ] **Versionado con rollback** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea*: cada publicaci√≥n genera snapshot con ID de versi√≥n.
* [ ] **UI Rollback** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: bot√≥n ‚ÄúRevertir a versi√≥n X‚Äù con confirmaci√≥n.
* [ ] **Audit trail** ‚Äî *tarea*: registrar rollback como acci√≥n separada (`THEME_ROLLBACK`).
* [ ] **Checkpoint D**: hacer rollback restaura tokens/variantes previas y auditor√≠a conserva historial.

### E. Shareable Previews

* [ ] **Enlace temporal** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: generar link con `previewToken` compartible.
* [ ] **Expiraci√≥n configurable** ‚Äî *tarea*: default 24h, con posibilidad de 1‚Äì7 d√≠as.
* [ ] **Revocaci√≥n anticipada** ‚Äî *tarea*: OWNER/ADMIN pueden revocar previews desde panel.
* [ ] **Checkpoint E**: compartir link a preview abre sandbox aislado; tras expiraci√≥n ‚Üí 401; revocaci√≥n manual ‚Üí invalida.

### F. Pruebas

* [ ] **Unit tests** ‚Äî *tarea*: validaci√≥n de estados (`draft‚Üíreview‚Üípublished`, rechazo en caso inv√°lido).
* [ ] **E2E tests** ‚Äî *tarea*:

  * [ ] Crear tema draft.
  * [ ] Pasar a review.
  * [ ] Aprobar y publicar.
  * [ ] Programar publicaci√≥n y verificar ejecuci√≥n por job.
  * [ ] Rollback y confirmaci√≥n en UI.
  * [ ] Preview compartido ‚Üí v√°lido, luego caduca.
* [ ] **Carga** ‚Äî *tarea*: 100 previews simult√°neos por tenant sin impacto en prod.
* [ ] **Checkpoint F**: todas pruebas verdes; cobertura >75%.

### G. DoD (Definition of Done) Secci√≥n 6

* [ ] Previews aislados con tokens temporales operativos.
* [ ] Flujo draft‚Üíreview‚Üípublish funcional con comentarios y auditor√≠a.
* [ ] Scheduling de publicaciones en producci√≥n.
* [ ] Rollback activo y probado.
* [ ] Enlaces de preview compartibles y revocables.
* [ ] Pruebas unit + e2e completas y cobertura m√≠nima cumplida.

# ‚úÖ Checklist ‚Äî 7) Export/Import & Marketplace

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Modelo y almacenamiento de artefactos

* [ ] **Entidad ThemeExport / StyleExport** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: `Export { id, tenantId, kind('theme'|'style'), refId(themeId|styleId), version, filename, size, hash(sha256), storageUrl, createdBy, createdAt, metadata(jsonb) }`.
* [ ] **Storage** ‚Äî *m√≥dulo*: `Infra` ¬∑ *tarea*: bucket S3/minio o carpeta segura; pol√≠tica de retenci√≥n y permisos (solo OWNER/ADMIN del tenant).
* [ ] **Checksum** ‚Äî *tarea*: calcular y almacenar `sha256` del paquete para verificar integridad.
* [ ] **Checkpoint A**: al exportar, se crea registro `Export`, archivo subido, tama√±o y hash visibles en UI.

### B. Export JSON/ZIP (tema y estilos)

* [ ] **Formato** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*:

  * Theme: `theme.json` (tokens, name, description, tags, version, createdAt, createdBy).
  * Styles: `styles.json` (components\[], variants\[], states, isDefault, mapping).
  * `manifest.json` (schemaVersion, kind, sourceTenant, createdAt, toolVersion).
  * ZIP opcional: incluir assets de fuentes (woff2) y licencia si aplica.
* [ ] **Comando/endpoint** ‚Äî *tarea*: `POST /v1/exports` body `{ kind, refId, includeAssets }` ‚Üí devuelve URL/ID.
* [ ] **Licencias** ‚Äî *tarea*: incluir `LICENSE.txt` cuando se empaquetan fuentes/icon packs.
* [ ] **Checkpoint B**: descargar ZIP y abrir `manifest.json` muestra metadatos correctos; `theme.json` valida contra schema de Secci√≥n 1.

### C. Import Seguro (dry-run y commit)

* [ ] **Validaci√≥n de schema** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: validar `manifest`, `theme.json`, `styles.json` (Zod/Joi) y versiones compatibles.
* [ ] **Dry-run** ‚Äî *tarea*: `POST /v1/imports/dry-run` ‚Üí responde **plan**: crear/clonar/actualizar; conflictos detectados (nombres/keys).
* [ ] **Resoluci√≥n de conflictos** ‚Äî *tarea*: estrategias: `rename`, `overwrite`, `skip`; UI para elegir por √≠tem.
* [ ] **Commit** ‚Äî *tarea*: `POST /v1/imports/commit` con plan aprobado.
* [ ] **Rollback** ‚Äî *tarea*: si commit falla a mitad, revertir entidades afectadas (transacci√≥n/unidad de trabajo).
* [ ] **Checkpoint C**: importar un paquete v√°lido crea tema/variantes en estado **draft** por defecto; conflictos resueltos seg√∫n elecci√≥n; auditor√≠a registra acciones.

### D. Marketplace (cat√°logo de presets)

* [ ] **Entidad CatalogItem** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: `CatalogItem { id, kind('theme'|'style'|'bundle'), name, description, tags[], version, rating?, installCount, visibility('public'|'private'), createdBy, updatedAt, artifactExportId }`.
* [ ] **Listado y filtros** ‚Äî *tarea*: `GET /v1/catalog?kind=&q=&tags=&sort=`; UI con cards, badges (light/dark, a11y AA, i18n-ready).
* [ ] **Instalaci√≥n** ‚Äî *tarea*: bot√≥n ‚ÄúInstalar‚Äù ‚Üí descarga `artifactExportId` y ejecuta flujo de **import (dry-run‚Üícommit)** hacia el tenant actual.
* [ ] **Actualizaciones** ‚Äî *tarea*: si hay versi√≥n nueva, mostrar ‚ÄúUpdate available‚Äù y diffs relevantes (tokens/variantes).
* [ ] **Checkpoint D**: desde Marketplace, instalar ‚ÄúGovernetix Light‚Äù crea tema draft en el tenant; se puede previsualizar y publicar.

### E. Seguridad, permisos y licencias

* [ ] **RBAC** ‚Äî *m√≥dulo*: `gAuth/gMemberships` ¬∑ *tarea t√©cnica*: OWNER/ADMIN pueden exportar/importar/instalar; EDITOR solo previsualizar; VIEWER no.
* [ ] **Sanitizaci√≥n** ‚Äî *tarea*: limpiar valores peligrosos en import (colores, URLs de fonts); bloquear CSS/JS inline; verificar CSP.
* [ ] **Licencias/atribuci√≥n** ‚Äî *tarea*: UI muestra licencia; impide instalar si licencia incompatible (opci√≥n de forzar con aceptaci√≥n expl√≠cita).
* [ ] **Checkpoint E**: intento de importar paquete con CSS malicioso ‚Üí 400; logs de seguridad registran incidente.

### F. Auditor√≠a y Cuotas

* [ ] **AuditLog** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: `EXPORT_CREATED`, `IMPORT_DRYRUN`, `IMPORT_COMMIT`, `CATALOG_INSTALL`; guardar hash del artefacto y plan aplicado.
* [ ] **Cuotas** ‚Äî *tarea*: l√≠mite de export/import por d√≠a por tenant; tama√±o m√°ximo de artefacto; rate limit por IP.
* [ ] **Checkpoint F**: exceder cuota ‚Üí 429 con cabeceras; auditor√≠a lista eventos con correlationId.

### G. UI en gAdmin

* [ ] **Pantalla de Export** ‚Äî *tarea t√©cnica*: seleccionar **Theme/Styles** + toggles (incluir assets, incluir variantes por defecto), bot√≥n **Exportar** ‚Üí Job + progreso.
* [ ] **Pantalla de Import** ‚Äî *tarea*: dropzone de archivo ZIP/JSON ‚Üí muestra **plan de dry-run**, selector de resoluci√≥n de conflictos, bot√≥n **Aplicar**.
* [ ] **Marketplace** ‚Äî *tarea*: `/admin/marketplace` con grid, filtros, detalles, **Preview** (iframe sandbox), **Instalar**.
* [ ] **Checkpoint G**: flujo completo visible, con estados (idle/loading/success/error), toasts y reintentos.

### H. Performance y almacenamiento

* [ ] **Streaming/Chunks** ‚Äî *m√≥dulo*: `Infra` ¬∑ *tarea t√©cnica*: subir/descargar artefactos con streaming; calcular hash en stream.
* [ ] **Compresi√≥n** ‚Äî *tarea*: usar ZIP `store` para fuentes (ya comprimidas) y `deflate` para JSON; tama√±o objetivo < 5MB en presets.
* [ ] **TTL/retenci√≥n** ‚Äî *tarea*: pol√≠tica para borrar artefactos antiguos; m√©trica de espacio consumido por tenant.
* [ ] **Checkpoint H**: export/import de \~3‚Äì5MB se completa < 5s en entorno local; tama√±o y tiempos registrados.

### I. Pruebas

* [ ] **Unit** ‚Äî *tarea t√©cnica*: validadores de schema, generador de plan de import, resolver de conflictos.
* [ ] **E2E** ‚Äî *tarea*:

  * [ ] Export de tema + estilos con assets.
  * [ ] Import dry-run ‚Üí commit con `rename/overwrite/skip`.
  * [ ] Instalar desde Marketplace y previsualizar.
  * [ ] Rollback autom√°tico ante error intencional.
* [ ] **Seguridad** ‚Äî *tarea*: tests de payloads maliciosos (CSS `expression`, URLs externas no permitidas, fuentes no v√°lidas).
* [ ] **Checkpoint I**: suites verde; cobertura ‚â• 75%; pruebas de seguridad pasan.

### J. DoD (Definition of Done) Secci√≥n 7

* [ ] Export JSON/ZIP con `manifest` y checksums listo.
* [ ] Import con dry-run, resoluci√≥n de conflictos y commit at√≥mico.
* [ ] Marketplace funcional con instalaci√≥n en un click (draft por defecto).
* [ ] Seguridad (sanitizaci√≥n, licencias, RBAC, cuotas) aplicada.
* [ ] UI completa (export/import/marketplace) con feedback y estados.
* [ ] Pruebas unitarias y e2e completas; m√©tricas de tama√±o/tiempo registradas.

# ‚úÖ Checklist ‚Äî 8) Accesibilidad & SEO por Defecto

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Accesibilidad (A11y Guard)

* [ ] **Contrast Checker** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea t√©cnica*: util que valide colores `foreground/background` con WCAG 2.1 (AA/AAA).
* [ ] **Focus Visible** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea*: aplicar `:focus-visible` por defecto; tokens de focusRing desde `gTheme`.
* [ ] **Tama√±o t√°ctil m√≠nimo** ‚Äî *tarea*: advertencia si botones/inputs < 44px (Apple HIG/Material).
* [ ] **A11y Overlay en Editor** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: mostrar warnings/errores a11y en UI al dise√±ar variantes.
* [ ] **Checkpoint A**: crear `button.primary` con contraste bajo ‚Üí aparece warning; focusRing visible en tab navigation.

### B. SEO Defaults en Themes

* [ ] **Metadatos globales** ‚Äî *m√≥dulo*: `gTheme/gAdmin` ¬∑ *tarea t√©cnica*: CRUD para t√≠tulo base, descripci√≥n, keywords, OG\:title/description, Twitter cards, favicon, manifest.
* [ ] **Plantilla OG din√°mica** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: endpoint que genere imagen OG por tema (puppeteer/satori).
* [ ] **Robots.txt / sitemap.xml** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: generar autom√°ticamente, incluir URLs por tenant, soportar i18n (hreflang).
* [ ] **Per-page overrides** ‚Äî *m√≥dulo*: `gPages` ¬∑ *tarea*: campos meta en p√°ginas (title, desc, canonical, noindex).
* [ ] **Checkpoint B**: crear un Theme ‚Üí setear t√≠tulo/OG; ver `<head>` con meta tags correctos en p√°gina demo.

### C. Carga de fuentes optimizada

* [ ] **Subsetting** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea t√©cnica*: cortar subsets de Google Fonts/local fonts por idioma.
* [ ] **Preconnect/Preload** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: inyectar `<link rel=preconnect>` y `<link rel=preload>` en `<head>`.
* [ ] **font-display: swap** ‚Äî *tarea*: configuraci√≥n por defecto para evitar FOIT.
* [ ] **Fallbacks inteligentes** ‚Äî *tarea*: tipograf√≠as alternas configurables por locale.
* [ ] **Checkpoint C**: Lighthouse no reporta FOIT; cambio de idioma usa fallback correcto.

### D. Integraci√≥n con i18n para SEO/A11y

* [ ] **hreflang autom√°tico** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: generar hreflang en `<head>` por p√°gina e idioma.
* [ ] **Lang attribute** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: inyectar `lang` correcto en `<html>`.
* [ ] **Alt text en media** ‚Äî *m√≥dulo*: `gPages` ¬∑ *tarea*: requerir alt/aria-label en im√°genes/√≠conos; warning si falta.
* [ ] **Checkpoint D**: p√°gina demo en 2 idiomas muestra `<html lang>` correcto y hreflang apuntando a la otra versi√≥n.

### E. Testing & Validaci√≥n

* [ ] **Unit** ‚Äî *tarea t√©cnica*: validadores WCAG, generador meta tags, verificador hreflang.
* [ ] **E2E** ‚Äî *tarea*: Lighthouse CI para cada p√°gina demo; assert `a11y ‚â• 95`, `SEO ‚â• 95`.
* [ ] **Accessibility snapshots** ‚Äî *tarea*: usar axe-core en test suite para validar reglas WCAG en componentes.
* [ ] **Checkpoint E**: correr suite e2e ‚Üí Lighthouse report ‚â• 95 en demo, sin violaciones axe-core cr√≠ticas.

### F. DoD (Definition of Done) Secci√≥n 8

* [ ] Guard de accesibilidad activo en editor (contraste, focus, tama√±o).
* [ ] Metadatos SEO globales y por p√°gina configurables y persistidos.
* [ ] OG images din√°micas funcionando por tenant.
* [ ] Carga de fuentes optimizada con swap y preloads.
* [ ] i18n integrado en SEO (hreflang, lang, fallbacks).
* [ ] Tests unit/e2e con Lighthouse y axe-core verificando ‚â•95.

# ‚úÖ Checklist ‚Äî 9) Seguridad & Compliance Visual

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Sanitizaci√≥n de Valores

* [ ] **Whitelist de propiedades** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: lista permitida de colores, unidades (`px`, `rem`, `%`), tipograf√≠as, √≠conos.
* [ ] **Validaci√≥n en backend** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea*: Zod/Joi schema en API; rechazar inyecci√≥n de CSS/JS arbitrario.
* [ ] **Escape seguro en frontend** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: usar `DOMPurify` o equivalente al renderizar descripciones/tokens.
* [ ] **Checkpoint A**: intentar inyectar `<script>alert()</script>` en un color/token ‚Üí API rechaza con 400.

### B. CSP-aware (Content Security Policy)

* [ ] **Generaci√≥n din√°mica de CSP** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: construir CSP a partir de fuentes e iconos habilitados.
* [ ] **Modo report-only** ‚Äî *tarea*: activar `Content-Security-Policy-Report-Only` primero para recopilar violaciones.
* [ ] **Differences Analyzer** ‚Äî *tarea*: servicio que muestra cambios CSP al modificar tema (ej. a√±adir fuente de Google).
* [ ] **Checkpoint B**: crear un Theme con fuente externa ‚Üí CSP actualizado incluye solo ese dominio.

### C. Consentimiento de Terceros

* [ ] **Consent Manager** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: gestor de consentimiento (analytics, chatbots, pixels) categorizados: *necessary*, *analytics*, *ads*, *support*.
* [ ] **Scripts Condicionados** ‚Äî *tarea*: solo cargar scripts tras consentimiento; almacenar preferencia por tenant/usuario.
* [ ] **UI Banner/Modal** ‚Äî *tarea*: multilenguaje; configurable desde admin.
* [ ] **Checkpoint C**: desactivar ‚Äúanalytics‚Äù en banner ‚Üí Google Analytics no aparece en `network` tab.

### D. Seguridad Avanzada de API/UI

* [ ] **Comparaci√≥n segura de tokens** ‚Äî *m√≥dulo*: `gAuth` ¬∑ *tarea*: usar `crypto.timingSafeEqual` en validaciones sensibles.
* [ ] **Rate limit sensible en admin** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: bucket distinto para panel de admin (m√°s restrictivo).
* [ ] **Body size limit** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: limitar payloads (`1MB` default, override en uploads).
* [ ] **Checkpoint D**: enviar payload >1MB en POST normal ‚Üí API responde 413 Payload Too Large.

### E. Auditor√≠a y Logs de Seguridad

* [ ] **AuditLog** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: registrar cambios en CSP, consent, seguridad avanzada (activaci√≥n/desactivaci√≥n de features).
* [ ] **Correlation ID** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: cada acci√≥n de seguridad vinculada con requestId.
* [ ] **Checkpoint E**: activar un CSP nuevo ‚Üí AuditLog guarda acci√≥n con ID de usuario y correlaci√≥n.

### F. Testing & Validaci√≥n

* [ ] **Unit Tests** ‚Äî validaci√≥n de schema seguro, CSP generator, consent service.
* [ ] **E2E** ‚Äî simulaci√≥n de inyecci√≥n maliciosa, verificaci√≥n CSP headers, toggling de consent.
* [ ] **PenTesting b√°sico** ‚Äî suite automatizada contra XSS, CSRF, CSP bypass.
* [ ] **Checkpoint F**: correr suite de pentest ‚Üí sin bypasses detectados.

### G. DoD (Definition of Done) Secci√≥n 9

* [ ] Tokens y estilos sanitizados en API/UI.
* [ ] CSP din√°mico actualizado seg√∫n selecci√≥n de fuentes/iconos.
* [ ] Consentimiento de terceros implementado y efectivo.
* [ ] L√≠mites de payload y rate limit reforzados en admin.
* [ ] Auditor√≠a de cambios de seguridad.
* [ ] Pruebas unit/e2e + pentest b√°sico superadas.

# ‚úÖ Checklist ‚Äî 10) Rendimiento & Publicaci√≥n

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Critical CSS & Split

* [ ] **Extracci√≥n de CSS cr√≠tico** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: usar herramientas (Next.js built-in o Critters) para generar CSS cr√≠tico por plantilla/p√°gina.
* [ ] **Code splitting de variantes pesadas** ‚Äî *tarea*: cargar din√°micamente componentes/variantes grandes (ej. tablas complejas) solo cuando se usen.
* [ ] **Checkpoint A**: Lighthouse muestra reducci√≥n de CSS no usado (<10%).

### B. Icon Budget

* [ ] **Limitador de sets de iconos** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea*: permitir seleccionar subset de √≠conos (ej. solo 20 m√°s usados).
* [ ] **Tree-shaking aplicado** ‚Äî *tarea*: configurar build para eliminar √≠conos no usados (ej. FontAwesome subsets o Lucide import selectivo).
* [ ] **Medici√≥n de impacto** ‚Äî *tarea*: mostrar peso de iconos incluidos en bundle.
* [ ] **Checkpoint B**: bundle de iconos <50KB, sin warnings de overfetch.

### C. Cache/ISR (Incremental Static Regeneration)

* [ ] **Pol√≠ticas de cache** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: habilitar `ETag`, `Last-Modified`, `Cache-Control` (`max-age`, `stale-while-revalidate`).
* [ ] **Revalidaci√≥n ISR** ‚Äî *tarea*: regenerar p√°ginas est√°ticas cuando cambia `gTheme` o `gStyle`; invalidar cache autom√°ticamente.
* [ ] **Checkpoint C**: cambiar un tema ‚Üí al refrescar, p√°gina cacheada refleja estilos en segundos, sin servir stale indefinidamente.

### D. Optimizaci√≥n de Recursos

* [ ] **Carga diferida (lazy loading)** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: im√°genes, videos, componentes secundarios.
* [ ] **Preload selectivo** ‚Äî *tarea*: precargar fuentes y assets cr√≠ticos (logo, tipograf√≠as, colores clave).
* [ ] **Imagen responsive** ‚Äî *tarea*: soporte WebP/AVIF + `next/image` con `srcset`.
* [ ] **Checkpoint D**: Lighthouse Performance ‚â• 95 en p√°ginas demo.

### E. Monitoreo de Rendimiento

* [ ] **M√©tricas en /metrics** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: exponer m√©tricas Prometheus: tiempo medio de render, LCP, CLS.
* [ ] **Alertas b√°sicas** ‚Äî *tarea*: configurar thresholds (ej. LCP > 2.5s) ‚Üí log warning.
* [ ] **Dashboard Grafana** ‚Äî *tarea*: opcional, visualizar m√©tricas de build/render.
* [ ] **Checkpoint E**: simular carga ‚Üí m√©tricas expuestas en /metrics con etiquetas (page, tenant).

### F. Auditor√≠a & Logs

* [ ] **AuditLog** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: registrar cambios en pol√≠ticas de cache, regeneraciones ISR, icon budgets.
* [ ] **Correlation ID** ‚Äî *tarea*: enlazar m√©tricas y logs de rendimiento con requestId.
* [ ] **Checkpoint F**: invalidar cache manualmente ‚Üí AuditLog refleja acci√≥n y m√©trica se ajusta.

### G. Testing & Validaci√≥n

* [ ] **Unit Tests** ‚Äî para funciones de extracci√≥n de CSS cr√≠tico, icon budget.
* [ ] **E2E** ‚Äî validar regeneraci√≥n ISR, cache headers correctos, carga diferida de im√°genes.
* [ ] **Lighthouse CI** ‚Äî correr auditor√≠a en pipeline (m√≠nimos de Performance ‚â• 95).
* [ ] **Checkpoint G**: CI bloquea si Lighthouse Performance < 95.

### H. DoD (Definition of Done) Secci√≥n 10

* [ ] CSS cr√≠tico extra√≠do y variantes pesadas divididas.
* [ ] Icon budget aplicado y medido.
* [ ] Cache + ISR con invalidaci√≥n autom√°tica funcionando.
* [ ] Recursos optimizados (lazy load, im√°genes responsive).
* [ ] M√©tricas Prometheus + alertas b√°sicas activas.
* [ ] Auditor√≠a y logs de rendimiento disponibles.
* [ ] Tests unit/e2e + Lighthouse CI verdes.

# ‚úÖ Checklist ‚Äî 11) i18n Avanzado aplicado a Theme/Style

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Overrides por Locale

* [ ] **Fuentes espec√≠ficas por idioma** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea t√©cnica*: permitir configurar tipograf√≠as diferentes para scripts distintos (ej. Noto Sans Arabic para √°rabe, Inter para lat√≠n).
* [ ] **Fallbacks por locale** ‚Äî *tarea*: definir `font-family` alternativos por idioma en tokens.
* [ ] **Ajustes RTL** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea*: activar modo RTL autom√°tico en base al locale (`dir="rtl"`) y ajustar tokens de espaciados/m√°rgenes.
* [ ] **Checkpoint A**: cambiar tenant a `ar-SA` aplica tipograf√≠a √°rabe + layout RTL sin romper componentes.

### B. Traducciones del Panel de Administraci√≥n

* [ ] **UI completa i18n** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: traducir todos los labels, men√∫s, tooltips y formularios con librer√≠a (ej. next-intl, i18next).
* [ ] **Glosarios por m√≥dulo** ‚Äî *tarea*: centralizar terminolog√≠a t√©cnica (Theme, Style, Token, Variant) con traducci√≥n consistente.
* [ ] **Gesti√≥n de estados de traducci√≥n** ‚Äî *tarea*: marcar strings no traducidos como `needs-review`.
* [ ] **Checkpoint B**: cambiar idioma de panel ‚Üí toda la UI traducida, sin strings ‚Äúhardcoded‚Äù.

### C. Sitemaps y SEO Multilenguaje

* [ ] **Sitemaps por idioma** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: generar sitemap.xml con URLs por locale.
* [ ] **Etiquetas hreflang** ‚Äî *tarea*: inyectar `<link rel="alternate" hreflang="...">` en p√°ginas p√∫blicas.
* [ ] **Canonical tags** ‚Äî *tarea*: evitar contenido duplicado entre locales, canonical a versi√≥n principal.
* [ ] **Checkpoint C**: inspecci√≥n SEO muestra hreflang correcto y canonical v√°lido para todas las p√°ginas multi-idioma.

### D. Previsualizaci√≥n por Idioma

* [ ] **Preview multi-locale** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: en sandbox, poder alternar idioma y ver reflejado tema/estilo aplicados.
* [ ] **Comparador de locales** ‚Äî *tarea*: vista que muestra en paralelo c√≥mo se ve la misma p√°gina en dos idiomas distintos.
* [ ] **Checkpoint D**: admin puede revisar traducci√≥n visual antes de publicar.

### E. Accesibilidad Multilenguaje

* [ ] **Marcado sem√°ntico** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: a√±adir atributo `lang` din√°mico al HTML `<html lang="...">`.
* [ ] **Compatibilidad lectores de pantalla** ‚Äî *tarea*: verificar que ARIA labels tambi√©n se traduzcan.
* [ ] **Checkpoint E**: VoiceOver/NVDA leen textos en idioma correcto seg√∫n locale.

### F. Auditor√≠a de Idiomas

* [ ] **AuditLog de cambios de traducci√≥n** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: registrar cuando se actualiza un texto o se carga una nueva traducci√≥n.
* [ ] **Historial de traducciones** ‚Äî *tarea*: versionar glosarios y permitir rollback.
* [ ] **Checkpoint F**: al revertir traducci√≥n, AuditLog registra cambio y UI refleja texto anterior.

### G. Testing & Validaci√≥n

* [ ] **Unit Tests** ‚Äî para resoluciones de tokens por locale y fallback de fuentes.
* [ ] **E2E Tests** ‚Äî navegaci√≥n entre idiomas, comprobaci√≥n de hreflang en HTML.
* [ ] **Lighthouse i18n** ‚Äî validar SEO multilenguaje ‚â•95.
* [ ] **Checkpoint G**: pipeline CI bloquea si hreflang ausente o traducciones faltantes.

### H. DoD (Definition of Done) Secci√≥n 11

* [ ] Overrides de fuentes, RTL y tokens por locale implementados.
* [ ] Panel admin traducido con glosarios consistentes.
* [ ] Sitemaps + hreflang + canonical activos y correctos.
* [ ] Previsualizaci√≥n multi-locale funcional.
* [ ] Accesibilidad en lectores de pantalla validada.
* [ ] Auditor√≠a de traducciones activa.
* [ ] Tests unit/e2e + validaciones SEO multilenguaje en CI.

# ‚úÖ Checklist ‚Äî 12) Gobernanza, Auditor√≠a y Flujo de Aprobaciones

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Modelo de Permisos Finos (RBAC ampliado)

* [ ] **Matriz de permisos granular** ‚Äî *m√≥dulo*: `gAuth/gMemberships` ¬∑ *tarea t√©cnica*: definir capacidades por recurso/acci√≥n: `theme:{create,edit,requestReview,approve,publish,rollback,export,import}`, `style:{create,edit,clone,setDefault,requestReview,approve,publish,rollback,export,import}`, `marketplace:{install,update}`, `pages:{overrideStyle}`.
* [ ] **Scopes por rol** ‚Äî *tarea*: OWNER (todas), ADMIN (todas salvo gesti√≥n de roles/tenant), REVIEWER (approve/publish), EDITOR (create/edit/requestReview, aplicar), VIEWER (read).
* [ ] **Policy resolver** ‚Äî *tarea*: servicio `can(user, action, resource, context)` con cach√© por request (tenant + rol + memberships).
* [ ] **Checkpoint A**: pruebas de `can()` retornan verdadero/falso correcto para combinaciones (rol √ó acci√≥n √ó recurso).

### B. Flujo de Aprobaciones (Draft ‚Üí Review ‚Üí Published)

* [ ] **Estados & transiciones** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: FSM: `draft ‚Üí review ‚Üí published`, `published ‚Üí draft (new version)`, `review ‚Üí changesRequested`, `changesRequested ‚Üí review`.
* [ ] **Solicitar revisi√≥n** ‚Äî *ruta*: `POST /v1/{themes|styles}/:id/request-review` (permiso: EDITOR+).
* [ ] **Aprobar/Rechazar** ‚Äî *ruta*: `POST /v1/{themes|styles}/:id/approve`, `POST .../request-changes` (permiso: REVIEWER+).
* [ ] **Publicar** ‚Äî *ruta*: `POST /v1/{themes|styles}/:id/publish` (permiso: ADMIN/OWNER).
* [ ] **Checkpoint B**: un EDITOR no puede publicar; REVIEWER puede aprobar; ADMIN publica; estados quedan persistidos y validados.

### C. Comentarios y Revisiones (Review Notes)

* [ ] **Entidad ReviewNote** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: `ReviewNote { id, entityType('theme'|'style'), entityId, authorId, comment, status('open'|'resolved'), createdAt, resolvedAt? }`.
* [ ] **UI de revisi√≥n** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: panel lateral con lista de notas; creaci√≥n inline sobre diffs de tokens/variantes.
* [ ] **Notificaciones** ‚Äî *tarea*: evento `review.note.created` ‚Üí webhook/email opcional a revisores.
* [ ] **Checkpoint C**: al crear ‚Äúchanges requested‚Äù, la entidad vuelve a `changesRequested` y el EDITOR ve las notas en UI.

### D. Auditor√≠a Enriquecida

* [ ] **Acciones tipadas** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: registrar `THEME_*` y `STYLE_*`: `CREATED, UPDATED, VERSIONED, REVIEW_REQUESTED, APPROVED, CHANGES_REQUESTED, PUBLISHED, ROLLBACK, ACTIVATED, EXPORTED, IMPORTED`.
* [ ] **Payload seguro** ‚Äî *tarea*: almacenar `before/after` minimizado (diff de tokens/variantes) sin datos sensibles; incluir `actorId, tenantId, correlationId, ip, userAgent`.
* [ ] **Consultas y filtros** ‚Äî *rutas*: `GET /v1/audit?entityType=&entityId=&action=&actorId=&from=&to=&limit=&cursor=`.
* [ ] **Checkpoint D**: auditor√≠a muestra l√≠nea de tiempo completa de un theme/variant con diffs; b√∫squedas por actor y rango de fechas funcionan.

### E. Reglas de Aprobadores y Pol√≠ticas

* [ ] **Required reviewers** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: configuraci√≥n por tenant: m√≠nimo N revisores; lista de revisores obligatorios por m√≥dulo.
* [ ] **Pol√≠ticas por plan** ‚Äî *tarea*: planes con exigencias distintas (ej. ‚ÄúEnterprise: 2 aprobadores y retenci√≥n 365 d√≠as‚Äù).
* [ ] **Bloqueo por incumplimiento** ‚Äî *tarea*: si no se cumplen pol√≠ticas, `publish` devuelve 412 Precondition Failed.
* [ ] **Checkpoint E**: configurar ‚Äú2 aprobadores‚Äù ‚Üí intento de publicar con 1 aprobador falla con 412.

### F. Gobernanza de Cambios Programados

* [ ] **Programaci√≥n con aprobaci√≥n** ‚Äî *m√≥dulo*: `gTheme/gStyle/Jobs` ¬∑ *tarea t√©cnica*: `scheduledAt` requiere estado `approved`; job no ejecuta si caduc√≥ aprobaci√≥n o cambi√≥ el diff.
* [ ] **Freeze windows** ‚Äî *tarea*: ventanas de congelamiento (sin publicaciones) configurables por tenant.
* [ ] **Checkpoint F**: programar publicaci√≥n en ventana ‚Äúfreeze‚Äù devuelve 409; fuera de ella, se permite tras aprobaci√≥n vigente.

### G. Export/Import con Firma y Trazabilidad

* [ ] **Firma de artefactos** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea t√©cnica*: firmar `manifest` (HMAC/Ed25519) y guardar `signature`.
* [ ] **Trazabilidad** ‚Äî *tarea*: asociar import a `sourceTenant` y `actor`; exigir aprobaci√≥n para activar artefactos externos.
* [ ] **Checkpoint G**: un import sin firma v√°lida ‚Üí 400; import externo requiere aprobaci√≥n REVIEWER antes de publicar.

### H. Alertas Operativas

* [ ] **Alert rules** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea t√©cnica*: alertar si hay >N cambios `published` en 1h, o si `rollback` ocurre >M veces/24h.
* [ ] **Canales** ‚Äî *tarea*: webhook/Slack/Email con plantillas; incluir correlationId y deep-links a auditor√≠a.
* [ ] **Checkpoint H**: simular 3 publicaciones r√°pidas ‚Üí alerta enviada al canal configurado.

### I. UI de Gobernanza

* [ ] **Tab ‚ÄúGovernance‚Äù** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: secci√≥n con: pol√≠ticas activas, required reviewers, freeze windows, cuotas, y √∫ltimos incidentes (alertas).
* [ ] **Workflow view** ‚Äî *tarea*: diagrama de estados (draft‚Üíreview‚Üípublished) con pasos y responsables.
* [ ] **Checkpoint I**: desde la UI se pueden ajustar pol√≠ticas y ver su impacto inmediatamente (p. ej., requerido 2 aprobadores ‚Üí UI cambia indicadores).

### J. Testing & Compliance

* [ ] **Unit** ‚Äî *tarea t√©cnica*: `PolicyService`, `ApprovalService`, `AuditService`.
* [ ] **E2E** ‚Äî *tarea*:

  * [ ] Draft ‚Üí Review ‚Üí Approve ‚Üí Publish con required reviewers.
  * [ ] Publish bloqueado por pol√≠tica (freeze/required reviewers).
  * [ ] Auditor√≠a completa con diffs y correlationId.
  * [ ] Import externo requiere aprobaci√≥n.
* [ ] **Retenci√≥n** ‚Äî *tarea*: job que purga logs > pol√≠tica (p. ej., 180/365 d√≠as) con export previo opcional.
* [ ] **Checkpoint J**: suites verdes; auditor√≠a exportada antes de purga; pol√≠ticas aplicadas correctamente.

### K. DoD (Definition of Done) Secci√≥n 12

* [ ] RBAC granular operativo con `can()` en backend y UI consciente de permisos.
* [ ] Flujo de aprobaciones completo con comentarios y transiciones FSM.
* [ ] Auditor√≠a enriquecida con diffs, filtros y correlationId.
* [ ] Pol√≠ticas de gobernanza (required reviewers, freeze windows, planes) aplicadas.
* [ ] Firma/validaci√≥n en export/import con trazabilidad.
* [ ] Alertas operativas configuradas.
* [ ] Pruebas unit/e2e + retenci√≥n y export de auditor√≠a implementadas.

# ‚úÖ Checklist ‚Äî 13) DX & Cat√°logo Visual

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Tipados & Documentaci√≥n T√©cnica

* [ ] **Tipos expuestos** ‚Äî *m√≥dulo*: `plugin-sdk` ¬∑ *tarea*: publicar `Theme`, `StyleToken`, `ComponentVariant`, `ThemeVersion` como tipos TS con JSDoc.
* [ ] **Docs en l√≠nea** ‚Äî *tarea*: a√±adir comentarios de uso en los tipos (ej. `Theme.color.primary` ‚Üí hex/rgba permitido).
* [ ] **Readme SDK** ‚Äî *tarea*: gu√≠a r√°pida de uso: c√≥mo inicializar cliente con tenant + auth; ejemplos de consumir themes/styles.
* [ ] **Checkpoint A**: generador de SDK produce `.d.ts` con comentarios; en un proyecto demo, intellisense muestra documentaci√≥n.

### B. Cat√°logo Visual (Storybook / Docs UI)

* [ ] **Instalar Storybook** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: configurar Storybook con soporte multi-tenant y tokens CSS.
* [ ] **Historias por componente** ‚Äî *m√≥dulo*: `gStyle` ¬∑ *tarea*: cada componente (Button, Input, Table‚Ä¶) con variantes principales.
* [ ] **Temas din√°micos** ‚Äî *tarea*: knob/toolbar en Storybook para alternar entre temas/variantes activos.
* [ ] **A11y Addon** ‚Äî *tarea*: integrar addon de accesibilidad (contrastes, labels, roles).
* [ ] **Checkpoint B**: Storybook muestra botones en todos los estilos; cambiar tema los actualiza en vivo; addon a11y pasa m√≠nimo AA.

### C. Ejemplos & Snippets

* [ ] **Snippets TS/JSX** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: generar snippets de uso (`<Button variant="primary" />`, `<Card theme="dark" />`).
* [ ] **Snippets CSS/Vars** ‚Äî *m√≥dulo*: `gTheme` ¬∑ *tarea*: exportar ejemplos de `:root { --color-primary: ‚Ä¶ }`.
* [ ] **Copiar desde UI** ‚Äî *tarea*: bot√≥n de copiar en el cat√°logo visual.
* [ ] **Checkpoint C**: usuario copia snippet y funciona en app externa con el SDK.

### D. Integraci√≥n DX

* [ ] **CLI Tools** ‚Äî *m√≥dulo*: `plugin-sdk` ¬∑ *tarea*: comando `g5 sdk update` para regenerar tipos/snippets.
* [ ] **Hot Reload** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: cambios en tokens/variantes refrescan cat√°logo visual sin reiniciar.
* [ ] **Checkpoint D**: correr `g5 sdk update` actualiza tipos y snippets; cat√°logo se refresca en <3s.

### E. Testing

* [ ] **Unit**: tipados correctos, snippets v√°lidos (parse JSX).
* [ ] **E2E**: cargar Storybook, cambiar tema, copiar snippet, validaci√≥n a11y.
* [ ] **Checkpoint E**: Lighthouse sobre Storybook ‚â•90 en performance + a11y.

### F. DoD (Definition of Done) Secci√≥n 13

* [ ] SDK con tipos documentados.
* [ ] Cat√°logo visual navegable (Storybook).
* [ ] Snippets exportables y probados.
* [ ] Integraci√≥n CLI y hot reload.
* [ ] Tests unit/e2e + a11y.

---

# ‚úÖ Checklist ‚Äî 14) Release & Calidad

**Estados:** \[x] Hecho ¬∑ \[\~] En progreso ¬∑ \[ ] No hecho

### A. Testing Automatizado

* [ ] **Unit tests** ‚Äî *m√≥dulo*: `gAdmin/gTheme/gStyle` ¬∑ *tarea*: validar parsers de tokens, FSM de estados (draft‚Üíreview‚Üípublish), resoluci√≥n de overrides.
* [ ] **E2E tests** ‚Äî *tarea*: pruebas completas: crear tema, editar variante, solicitar review, aprobar, publicar, rollback, export/import.
* [ ] **Visual Regression** ‚Äî *tarea*: snapshots visuales en Storybook (Percy/Chromatic).
* [ ] **A11y Regression** ‚Äî *tarea*: axe-core en e2e para validar contrastes y roles.
* [ ] **Checkpoint A**: pipeline muestra 100% suites verdes; diffs visuales reportados.

### B. CI/CD Pipeline

* [ ] **Lint/Build/Test Gates** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: flujo GitHub Actions: lint ‚Üí build ‚Üí unit ‚Üí e2e ‚Üí coverage.
* [ ] **Coverage Thresholds** ‚Äî *tarea*: branches ‚â•70%, funcs ‚â•75%, lines ‚â•80%.
* [ ] **Artifacts Build** ‚Äî *tarea*: generar openapi.json, postman\_collection.json, sdk TS.
* [ ] **Preview Deploy** ‚Äî *tarea*: levantar entorno temporal por PR (Vercel/Netlify) con link de cat√°logo visual.
* [ ] **Checkpoint B**: PR muestra checks verdes y link de preview accesible.

### C. Versionado & Tags

* [ ] **Semver** ‚Äî *m√≥dulo*: `gTheme/gStyle` ¬∑ *tarea*: versionado sem√°ntico (major/minor/patch) en releases.
* [ ] **Changelog auto** ‚Äî *tarea*: usar Conventional Commits + `changeset` para generar CHANGELOG.md.
* [ ] **GitHub Release** ‚Äî *tarea*: crear tag y release con notas, changelog y artefactos.
* [ ] **Checkpoint C**: crear tag `v1.0.0` genera release con changelog y SDK publicado.

### D. Publicaci√≥n de Artefactos

* [ ] **SDK NPM** ‚Äî *m√≥dulo*: `plugin-sdk` ¬∑ *tarea*: publicar cliente TS en GitHub Packages o npm privado.
* [ ] **Postman Collection** ‚Äî *tarea*: export y publicar en repo/docs.
* [ ] **Docs site** ‚Äî *m√≥dulo*: `gAdmin` ¬∑ *tarea*: deploy de documentaci√≥n (Docusaurus/Next docs).
* [ ] **Checkpoint D**: SDK instalable v√≠a `npm i @governetix/g5-sdk`; docs accesibles online.

### E. Calidad Operativa

* [ ] **Lint estricto** ‚Äî *tarea*: ESLint + TS strict + Prettier enforced.
* [ ] **Security Scan** ‚Äî *tarea*: SAST (npm audit, CodeQL).
* [ ] **Performance budget** ‚Äî *tarea*: Lighthouse CI con LCP <2.5s, CLS <0.1, bundle <250KB.
* [ ] **Checkpoint E**: pipeline falla si audit tiene vulnerabilidades altas o LCP >2.5s.

### F. Definition of Done Secci√≥n 14

* [ ] Tests unit/e2e/visual/a11y cubiertos.
* [ ] CI/CD pipeline completo con preview deploy.
* [ ] Versionado sem√°ntico y changelog automatizado.
* [ ] SDK, Postman y docs publicados.
* [ ] Calidad garantizada (lint, security, performance budgets).